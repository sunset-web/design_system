{"version":3,"file":"droplist-header.bundle.js","sources":["../src/components/Item.js","../src/droplist-headerStore.js","../src/droplist-header.js"],"sourcesContent":["export const Item = {\r\n   props: [\"item\"],\r\n   /* html */\r\n   template: `\r\n   <li ref=\"elem\" :data-id=\"item.id\">\r\n      <div class=\"date\">{{item.UF_DATE}}</div>\r\n      <div>{{item.UF_TEXT}}</div>\r\n   </li>\r\n   `,\r\n};\r\n","import { defineStore } from \"ui.vue3.pinia\";\r\n\r\nexport const dropListHeaderStore = defineStore(\"dropListHeaderStore\", {\r\n   state: () => {\r\n      return {\r\n         units: [],\r\n      };\r\n   },\r\n   actions: {\r\n      // Проверка наличия элемента\r\n      getUnit(id) {\r\n         return this.units.find((unit) => unit.id === id);\r\n      },\r\n      constructUnit(id, list) {\r\n         // Получение значений\r\n         let arrInStore = this.getUnit(id);\r\n\r\n         if (arrInStore) {\r\n            arrInStore.list = list;\r\n         } else {\r\n            this.units.push({\r\n               id: id,\r\n               list: list,\r\n            });\r\n         }\r\n      },\r\n   },\r\n});\r\n","import { BitrixVue } from \"ui.vue3\";\nimport { mapActions } from \"ui.vue3.pinia\";\nimport { Item } from \"./components/Item\";\nimport { dropListHeaderStore } from \"./droplist-headerStore\";\n/**\n * дефолтный компонент реализующий логику получения элементов\n * запись в хранилище\n * обработка и передача на вывод\n */\nexport const DroplistHeader = BitrixVue.mutableComponent('DroplistHeader', {\n\tname: 'DroplistHeader',\n\tcomponents: {\n\t\tItem,\n\t},\n\tprops: ['arParams'],\n\tdata() {\n\t\treturn {\n\n\t\t\tlink: this.arParams.LINK_PAGE,\n\t\t\titems: [],\n\t\t\titemsLen: [],\n\t\t};\n\t},\n\tcomputed: {\n\t\tcountItems() {\n\t\t\t// Кол-во элементов для отображения\n\t\t\treturn this.itemsLen.length > 10 ? '10+' : Number(this.itemsLen.length);\n\t\t},\n\t},\n\tmethods: {\n\t\t// Берем лишь нужное кол-во на вывод\n\t\tarrSlice(arr) {\n\t\t\tarr.splice(this.arParams.COUNT, arr.length);\n\t\t},\n\t\t// Добавление элемента\n\t\taddItem(response) {\n\n\t\t\t// Собираем элемент\n\t\t\tlet objAdd = {\n\t\t\t\tID: String(response.id),\n\t\t\t\t...response.fields,\n\t\t\t};\n\n\t\t\t// Проверяем HL-блок\n\t\t\tif (this.arParams.HL_ID == response.hl_id) {\n\n\t\t\t\tthis.items.unshift(objAdd);\n\t\t\t\tthis.itemsLen.unshift(objAdd);\n\n\t\t\t\tthis.arrSlice(this.items);\n\n\t\t\t\tthis.constructUnit(response.hl_id, this.itemsLen);\n\n\t\t\t}\n\t\t},\n\t\tupdateItem(response) {\n\t\t\t// Проверяем флаг просмотра\n\t\t\tif (response.view == 'true' && this.arParams.HL_ID == response.hl_id) {\n\n\t\t\t\tObject.assign(this.items, this.itemsLen);\n\t\t\t\t// Удаляем элементы\n\t\t\t\tthis.items.map((item, index) => {\n\t\t\t\t\tif (item.ID == response.id) {\n\t\t\t\t\t\tthis.items.splice(index, 1);\n\t\t\t\t\t\tthis.itemsLen.splice(index, 1);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.arrSlice(this.items);\n\n\t\t\t\tthis.constructUnit(response.hl_id, this.itemsLen);\n\n\t\t\t}\n\n\t\t},\n\t\t// Получение списка методов хранилища\n\t\t...mapActions(dropListHeaderStore, {\n\t\t\tconstructUnit: \"constructUnit\",\n\t\t\tgetUnit: \"getUnit\",\n\t\t}),\n\t},\n\tmounted() {\n\t\t// запрос на получение списка\n\t\tBX.ajax\n\t\t\t.runComponentAction(\"itin:hl.news.list\", \"getList\", {\n\t\t\t\tmode: \"class\",\n\t\t\t\tdata: {\n\t\t\t\t\thl_id: this.arParams.HL_ID,\n\t\t\t\t},\n\t\t\t})\n\t\t\t.then((response) => {\n\n\t\t\t\tObject.assign(this.itemsLen, response.data.result);\n\t\t\t\tObject.assign(this.items, response.data.result);\n\n\t\t\t\tthis.arrSlice(this.items);\n\t\t\t\t// запись в хранилище\n\t\t\t\tthis.constructUnit(this.arParams.HL_ID, this.itemsLen);\n\t\t\t});\n\t\t// Подписка на событие\n\t\tBX.PULL.start();\n\t\tBX.addCustomEvent(\"onPullEvent\", (module_id, command, params) => {\n\t\t\tif (module_id == \"droplistheader\") {\n\t\t\t\tif (command == \"check\") {\n\t\t\t\t\tthis.addItem(params.response);\n\t\t\t\t}\n\t\t\t\tif (command == \"update\") {\n\t\t\t\t\tthis.updateItem(params.response);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t},\n});"],"names":["Item","props","template","dropListHeaderStore","defineStore","state","units","actions","getUnit","id","find","unit","constructUnit","list","arrInStore","push","DroplistHeader","BitrixVue","mutableComponent","name","components","data","link","arParams","LINK_PAGE","items","itemsLen","computed","countItems","length","Number","methods","_objectSpread","arrSlice","arr","splice","COUNT","addItem","response","objAdd","ID","String","fields","HL_ID","hl_id","unshift","updateItem","_this","view","Object","assign","map","item","index","mapActions","mounted","_this2","BX","ajax","runComponentAction","mode","then","result","PULL","start","addCustomEvent","module_id","command","params"],"mappings":"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"}